(function(){var t,e=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};$.easing.easeOutCubic=function(t,e,i,r,n){return r*((e=e/n-1)*e*e+1)+i},t=function(){function t(){}return t.data={scroll:{top:0,left:0},win:{width:0,height:0}},t.hasInitialized=!1,t.articles=$("#main").children(),t.init=function(){return this.testMobile(),this.setLanguage(),this.setupTemplates(),this.setupListeners(),this.setupExtras(),this.updateCurrent(),this.hasInitialized=!0,this},t.setupListeners=function(){return this.helperListeners(),this.navListeners(),this.playerListeners(),this.keyboardNavigation()},t.helperListeners=function(){return $(window).on({scroll:function(t){return function(){var e;return e=window.scrollY,t.data.scroll.direction=e<t.data.scroll.top?"up":"down",t.data.scroll.top=e,t.data.scroll.left=$("html, body").scrollLeft(),t.hasInitialized?t.updateCurrent():void 0}}(this),resize:function(t){return function(){return t.data.win.width=$(window).width(),t.data.win.height=$(window).height(),t.data.win.ratio=t.data.win.width/t.data.win.height,t.data.margin=t.data.win.height/3,t.adjustArticles(),t.adjustBackground(),t.adjustPlayer()}}(this)}).trigger("resize").trigger("scroll")},t.addArrow=function(){var t;return t=$(".arrowDown"),setTimeout(function(){return t.addClass("active")},3e3),t.on("mouseenter",function(e){return function(){return $("body,html").animate({scrollTop:e.data.win.height},1e3,"easeOutCubic"),t.removeClass("active")}}(this))},t.adjustArticles=function(){return $("#main").css("top",0),this.articles.css("min-height",this.data.win.height)},t.setLanguage=function(){var t;return t=location.pathname.replace("/",""),"es"!==t&&"en"!==t&&(t=/es/.test(navigator.language)?"es":"en"),this.switchLanguage(t)},t.setupTemplates=function(){var t;return t=this,t.templates={},_.templateSettings={interpolate:/\{\{\s*(.+?)\s*\}\}/g},$('[type="text/x-template"]').each(function(){var e;return e=$(this).attr("id"),t.templates[e]=_.template($(this).html())})},t.setupExtras=function(){var t;return t=this,this.articles.each(function(){var e;return e=$(this),t.addToMenu(e),t.addToBackground(e,t)}),$("#video-background video").each(function(){var e,i;return e=null,i=function(){},this.addEventListener("loadedmetadata",function(){return $(this).addClass("loadedmetadata"),t.adjustBackground()}),this.addEventListener("canplaythrough",function(){return $(this).addClass("canplay")})}),$("body").addClass("black")},t.testMobile=function(){return this.isMobile=Modernizr.touch&&Modernizr.mq("(max-device-width: 480px)"),this.isTablet=Modernizr.touch&&Modernizr.mq("(min-device-width: 768px)and (max-device-width: 1024px)")},t.switchLanguage=function(t){var i,r,n;return null==t&&(t=""),i=$("html"),n=["es","en"],r=location.hash.replace("#",""),e.call(n,t)<0&&(t=_.find(n(function(t){return t!==i.attr("lang")}))),i.attr("lang",t),$("#lang a").removeClass("current"),$("#lang a[href*='"+t+"']").addClass("current"),history.replaceState({lang:t},$("h1").text(),"/"+t+"#"+r)},t.addToMenu=function(t){var e,i,r;return e=$("#filmlist"),i=t.find("h2").html(),r=t.attr("id"),"intro"===r&&(i=""),"bio"===r&&(e.append("<li>&nbsp;</li>"),i="Bio"),e.append("<li><a href='#"+r+"'>"+i+"</a></li>")},t.navListeners=function(){var t;return t=this,this.isMobile||($("nav .row > li").on("mouseenter",function(){return $("#filmlist").addClass("expanded")}),$("nav .row").on({mouseleave:function(){return $("#filmlist").removeClass("expanded")},mouseover:function(t){return $(t.target).is("nav .row")?$("#filmlist").removeClass("expanded"):void 0}}),$("#filmlist").on({mouseover:function(){return $(this).parent().is(".current")?void 0:$("#filmlist li.current").addClass("disabled")},mouseout:function(){return $("#filmlist li.current").removeClass("disabled")}},"a")),$("#filmlist").on({click:function(e){return e.preventDefault(),$("#filmlist").is(".expanded")?t.setCurrent($(this)):$("#filmlist").addClass("expanded"),!1}},"a"),$("h1 a").on("click",function(){return t.setCurrent($(this))}),$("#lang a").on("click",function(e){var i;return i=$(this).attr("href").replace(/\W/g,""),t.switchLanguage(i),e.preventDefault()})},t.keyboardNavigation=function(){return this.keys={ARROW_UP:38,ARROW_DOWN:40,ARROW_LEFT:37,ARROW_RIGHT:39},$(window).on("keydown",function(t){return function(e){switch(_.contains(t.keys,e.keycode)&&e.preventDefault(),e.keyCode){case t.keys.ARROW_UP:return t.setCurrentTo("prev");case t.keys.ARROW_LEFT:return t.setCurrentTo("prev");case t.keys.ARROW_DOWN:return t.setCurrentTo("next");case t.keys.ARROW_RIGHT:return t.setCurrentTo("next")}}}(this))},t.isCurrent=function(t){var e,i;return"up"===this.data.scroll.direction?(i=t.offset().top+t.height()-(this.data.scroll.top+this.data.win.height),e=2*this.data.margin):(i=t.offset().top-this.data.scroll.top,e=this.data.margin),(this.isMobile||this.isTablet)&&(e=this.data.win.height/2),Math.abs(i)<e},t.updateCurrent=function(){var t,e;if(!this.hasInitialized&&(t=location.hash,t.length&&$(t).length))return void this.setCurrent($(t));if(!this.current||!this.isCurrent(this.current))return e=this,this.articles.each(function(){var t;return t=$(this),e.isCurrent(t)?(e.setCurrent(t),!1):void 0})},t.setCurrentTo=function(t){var e;if("next"===t)e=this.current.is(":last-child")?!1:this.current.next();else{if("prev"!==t)return;e=this.current.is(":first-child")?!1:this.current.prev()}return e?this.setCurrent(e,!0):void 0},t.setCurrent=function(t,e){var i,r;if(this.articles.is(t)){if(this.current&&this.current.is(t))return;this.current=t}else{if(r=t.attr("href"),this.current=$(r),!this.current.length)return;if(this.current&&this.current.is(t))return;e=!0}return this.hasInitialized&&e&&$("body, html").animate({scrollTop:this.current.offset().top},500),$("#filmlist li, h1","nav").removeClass("current"),$("nav [href='#"+this.current.attr("id")+"']").parent().addClass("current"),$("#filmlist").removeClass("expanded"),$('nav .current [href="#bio"]').length&&$(".current").addClass("dark"),i=this.current.attr("id")?this.current.attr("id"):"intro",history.replaceState({section:i},this.current.find("h2").text(),"#"+this.current.attr("id")),this.updateBackground(),this.current.is("#intro")?this.addArrow():$(".arrowDown").removeClass("active")},t.addToBackground=function(t,e){var i,r,n;return n=t.data("background").split(";"),i={},_.each(n,function(t){var e;return e=t.split(","),e.length>1?i[e[0]]=e[1]:void 0}),r={slug:t.attr("id"),background:i},i=this.isMobile?e.templates.imgbg(r):e.templates.videobg(r),"white"===r.background&&(i="<div id='video-bio'></div>"),$("#video-background").append(i)},t.adjustBackground=function(){var t,e;return t=$("#video-background .current"),e=t.is("video.loadedmetadata")?t[0].videoWidth/t[0].videoHeight:1.67,this.data.win.ratio<e&&!t.hasClass("wide")?(t.css({width:"auto",height:"100%"}),t.addClass("wide").removeClass("tall")):this.data.win.ratio>=e&&!t.hasClass("tall")?(t.css({width:"100%",height:"auto"}),t.removeClass("wide").addClass("tall")):void 0},t.updateBackground=function(){var t,e,i;return i=this.current.attr("id"),t=$("#video-background #video-"+i),e=$("#video-background .current"),e.length&&(e.removeClass("current"),e.is("video")&&e[0].pause()),t.length&&(t.addClass("current"),this.adjustBackground(),t.is("video"))?this.playIfReady(t):void 0},t.playIfReady=function(t){var e;return e=setInterval(function(){var i;return t[0].buffered.length&&(i=t[0].buffered.end(0)/t[0].duration*100),t.hasClass("canplay")?(t[0].play(),clearInterval(e)):void 0},100)},t.playerListeners=function(){var t,e,i;return i=this,t=$("#player"),e=function(){return function(e){return e.preventDefault(),$("figure",t).html(""),t.removeClass("playing"),i.updateCurrent()}}(this),$(".close",t).on("click",e),$(window).on("keydown",function(){return function(t){return 27===t.keyCode?e(t):void 0}}(this)),this.articles.each(function(){var t;return t=$(this),t.find('.still [href^="#youtube="], .still [href^="#vimeo="]').on("click",function(t){var e,r,n;if(t.preventDefault(),e=$(this).attr("href").replace("#","").split("="),r=e[0],n=e[1],!_.isEmpty(n)){if($("#player").addClass("playing"),"vimeo"===r)return $("#player figure").html(i.templates.vimeo({vimeo_id:n}));if("youtube"===r)return $("#player figure").html(i.templates.youtube({youtube_id:n}))}})})},t.adjustPlayer=function(){var t;return t=$("#player figure"),this.data.win.ratio<1.77?(t.width(this.data.win.width-50),t.height(t.width()/1.77)):(t.height(this.data.win.height-90),t.width(1.77*t.height()))},t}(),$(function(){return window.OZH=t.init()})}).call(this);